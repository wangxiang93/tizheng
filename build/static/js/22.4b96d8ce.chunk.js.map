{"version":3,"sources":["options sync nonrecursive /.js$","options/system.js","webpack://react-admin/./src/pages/system/menus/style.less?e6c4","pages/system/menus/style.less","pages/system/menus/MenuEdit.jsx","../node_modules/@ant-design/icons-svg/es/asn/PlusOutlined.js","../node_modules/@ant-design/icons/es/icons/PlusOutlined.js","pages/system/menus/ActionEdit.jsx","pages/system/menus/index.jsx","options/index.js"],"names":["map","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","menuTarget","value","label","yesNo","tag","color","enabled","sex","system","ajax","get","list","item","title","meta","action","api","content","__esModule","default","i","options","locals","___CSS_LOADER_EXPORT___","push","menuTargetOptions","TabPane","config","props","isAdd","selectedMenu","onSubmit","onValuesChange","useForm","form","useState","loading","setLoading","addTabKey","setAddTabKey","useHeight","textAreaHeight","contentRef","useRef","hasSelectedMenu","length","isAddTop","isAddSub","WITH_SYSTEMS","deleteMenu","useDel","run","saveMenu","usePost","branchSaveMenu","updateMenu","fetchMenuByName","useGet","saveRole","useEffect","resetFields","initialValues","order","ord","target","parentId","systemId","setFieldsValue","handleSubmit","useCallback","values","a","params","type","sort","menus","json5","parse","error","res","name","remark","isUpdate","checkName","useDebounceValidator","rule","menu","getFieldValue","menuId","handleDelete","isDelete","layout","labelCol","flex","onFinish","styles","pane","ref","activeKey","onChange","key","tab","hidden","tooltip","required","getPopupContainer","current","checkedChildren","unCheckedChildren","shouldUpdate","noStyle","rules","validator","pattern","message","startsWith","Promise","reject","noSpace","rows","style","height","placeholder","footerAction","onConfirm","danger","htmlType","PlusOutlined","React","AntdIcon","assign","icon","PlusOutlinedSvg","displayName","save","successTip","actions","marginTop","description","List","fields","add","remove","display","marginBottom","align","initialValue","MinusCircleOutlined","onClick","block","disabled","path","setIsAdd","setSelectedMenu","hasUnSaveMenu","setHasUnSaveMenu","hasUnSaveAction","setHasUnSaveAction","formatResult","index","arr","filter","it","data","fetchMenus","checkUnSave","showTip","confirm","handleClick","menuData","find","useMemo","menuTreeData","convertToTree","b","loop","nodes","children","SubMenu","stopPropagation","data-menu","theme","antPrefix","Item","menuItems","handleMenuSubmit","nextNode","findNextNode","handleActionSubmit","fitHeight","s","menuRoot","menuTop","menuContent","mode","selectable","selectedKeys","info","result","require","forEach","includes","entries","k","wrapperOptions"],"mappings":"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","file":"static/js/22.4b96d8ce.chunk.js","sourcesContent":["var map = {\n\t\"./index.js\": 995,\n\t\"./system.js\": 1002\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 1001;","import { Tag } from 'antd';\r\nimport ajax from 'src/commons/ajax';\r\n\r\n/**\r\n * 项目中可能用到的一些枚举类数据\r\n * 约定只含有三个参数，\r\n * {\r\n *  value: 1,      // 必须且不可重复\r\n *  label: '名称', // 必须\r\n *  meta: {},     // 其他数据，可缺省\r\n *  tag: Tag      // 标签\r\n * };\r\n *\r\n * // 扩展方法\r\n * options.menuTarget.getLabel('menu')\r\n * options.yesNo.getTag(true);\r\n * */\r\nexport default {\r\n    // 菜单目标\r\n    menuTarget: [\r\n        { value: 'menu', label: '应用菜单' },\r\n        { value: 'qiankun', label: '乾坤子应用' },\r\n        { value: 'iframe', label: 'iframe内嵌第三方' },\r\n        { value: '_self', label: '当前窗口打开第三方' },\r\n        { value: '_blank', label: '新开窗口打开第三方' },\r\n    ],\r\n    // 是否\r\n    yesNo: [\r\n        { value: true, label: '是', tag: <Tag color=\"green\">是</Tag> },\r\n        { value: false, label: '否', tag: <Tag color=\"red\">否</Tag> },\r\n    ],\r\n    // 启用、禁用\r\n    enabled: [\r\n        { value: true, label: '启用', tag: <Tag color=\"green\">启用</Tag> },\r\n        { value: false, label: '禁用', tag: <Tag color=\"red\">禁用</Tag> },\r\n    ],\r\n    // 性别\r\n    sex: [\r\n        { value: '1', label: '男' },\r\n        { value: '2', label: '女' },\r\n        { value: '3', label: '未知' },\r\n    ],\r\n    // 可以是函数，异步或同步都可以\r\n    async system() {\r\n        const list = await ajax.get('/menu/queryTopMenus');\r\n        return list.map((item) => {\r\n            return {\r\n                value: item.id,\r\n                label: item.title,\r\n                meta: item,\r\n            };\r\n        });\r\n    },\r\n    action() {\r\n        return [{ value: 'add', label: '添加' }];\r\n        // throw Error('获取失败了');\r\n    },\r\n    // 使用 get\r\n    get demo() {\r\n        return [];\r\n    },\r\n};\r\n","var api = require(\"!../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../node_modules/css-loader/dist/cjs.js??ref--5-oneOf-10-1!../../../../node_modules/less-loader/dist/cjs.js??ref--5-oneOf-10-2!./style.less\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nmodule.exports = content.locals || {};","// Imports\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(true);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".menuRoot_113Rj {\\n  display: flex;\\n}\\n.menu_15fDF {\\n  flex: 0 0 210px;\\n  width: 210px;\\n  display: flex;\\n  flex-direction: column;\\n  border-right: 1px solid #d9d9d9;\\n}\\n.menu_15fDF .menuTop_3pH2W {\\n  padding: 8px;\\n  margin-right: 8px;\\n  display: flex;\\n  align-items: center;\\n  border-bottom: 1px solid #d9d9d9;\\n}\\n.menu_15fDF .menuContent_2V06a {\\n  flex: 1;\\n  overflow: auto;\\n}\\n.menu_15fDF .react-admin-menu-submenu {\\n  position: relative;\\n}\\n.menu_15fDF .react-admin-menu-submenu:after {\\n  position: absolute;\\n  top: 0;\\n  right: 0;\\n  height: 44px;\\n  border-right: 3px solid #1890ff;\\n  transform: scaleY(0.0001);\\n  opacity: 0;\\n  transition: transform 0.15s cubic-bezier(0.215, 0.61, 0.355, 1), opacity 0.15s cubic-bezier(0.215, 0.61, 0.355, 1);\\n  content: '';\\n}\\n.menu_15fDF .react-admin-menu-submenu.react-admin-menu-item-selected:after {\\n  opacity: 1;\\n  transform: scaleY(1);\\n}\\n.pane_FR57c {\\n  flex: 1;\\n  display: flex;\\n  flex-direction: column;\\n  border-right: 1px solid #d9d9d9;\\n}\\n.title_109pZ {\\n  flex: 0 0 40px;\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n  padding-top: 8px;\\n}\\n.content_3W3ih {\\n  flex: 1;\\n  overflow: auto;\\n  padding: 8px 32px;\\n}\\n.footerAction_1xl28 {\\n  flex: 0 0 50px;\\n  justify-content: flex-end;\\n  border-top: 1px solid #d9d9d9;\\n  padding: 0 10px;\\n  margin: 0 8px;\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/pages/system/menus/style.less\"],\"names\":[],\"mappings\":\"AAEA;EACI,aAAA;AAIJ;AADA;EACI,eAAA;EACA,YAAA;EACA,aAAA;EACA,sBAAA;EACA,+BAAA;AAGJ;AARA;EAQQ,YAAA;EACA,iBAAA;EACA,aAAA;EACA,mBAAA;EACA,gCAAA;AAGR;AAfA;EAgBQ,OAAA;EACA,cAAA;AAER;AAnBA;EAsBY,kBAAA;AAAZ;AAEY;EACI,kBAAA;EACA,MAAA;EACA,QAAA;EACA,YAAA;EACA,+BAAA;EACA,yBAAA;EACA,UAAA;EACA,kHAAA;EACA,WAAA;AAAhB;AAjCA;EAsCY,UAAA;EACA,oBAAA;AAFZ;AAOA;EACI,OAAA;EACA,aAAA;EACA,sBAAA;EACA,+BAAA;AALJ;AAQA;EACI,cAAA;EACA,aAAA;EACA,uBAAA;EACA,mBAAA;EACA,gBAAA;AANJ;AASA;EACI,OAAA;EACA,cAAA;EACA,iBAAA;AAPJ;AAUA;EACI,cAAA;EACA,yBAAA;EACA,6BAAA;EACA,eAAA;EACA,aAAA;AARJ\",\"sourcesContent\":[\"@import \\\"src/theme\\\";\\n\\n.menuRoot {\\n    display: flex;\\n}\\n\\n.menu {\\n    flex: 0 0 210px;\\n    width: 210px;\\n    display: flex;\\n    flex-direction: column;\\n    border-right: 1px solid @border-color-base;\\n\\n    .menuTop {\\n        padding: 8px;\\n        margin-right: 8px;\\n        display: flex;\\n        align-items: center;\\n        border-bottom: 1px solid @border-color-base;\\n    }\\n\\n    .menuContent {\\n        flex: 1;\\n        overflow: auto;\\n    }\\n\\n    :global {\\n        .@{ant-prefix}-menu-submenu {\\n            position: relative;\\n\\n            &:after {\\n                position: absolute;\\n                top: 0;\\n                right: 0;\\n                height: 44px;\\n                border-right: 3px solid @primary-color;\\n                transform: scaleY(0.0001);\\n                opacity: 0;\\n                transition: transform 0.15s cubic-bezier(0.215, 0.61, 0.355, 1), opacity 0.15s cubic-bezier(0.215, 0.61, 0.355, 1);\\n                content: '';\\n            }\\n        }\\n\\n        .@{ant-prefix}-menu-submenu.@{ant-prefix}-menu-item-selected:after {\\n            opacity: 1;\\n            transform: scaleY(1);\\n        }\\n    }\\n}\\n\\n.pane {\\n    flex: 1;\\n    display: flex;\\n    flex-direction: column;\\n    border-right: 1px solid @border-color-base;\\n}\\n\\n.title {\\n    flex: 0 0 40px;\\n    display: flex;\\n    justify-content: center;\\n    align-items: center;\\n    padding-top: 8px;\\n}\\n\\n.content {\\n    flex: 1;\\n    overflow: auto;\\n    padding: 8px 32px;\\n}\\n\\n.footerAction {\\n    flex: 0 0 50px;\\n    justify-content: flex-end;\\n    border-top: 1px solid @border-color-base;\\n    padding: 0 10px;\\n    margin: 0 8px;\\n}\\n\\n\\n@packageName: react-admin;\"],\"sourceRoot\":\"\"}]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {\n\t\"antPrefix\": \"react-admin\",\n\t\"raLibPrefix\": \"react-admin-ra\",\n\t\"primaryColor\": \"#1890ff\",\n\t\"menuRoot\": \"menuRoot_113Rj\",\n\t\"menu\": \"menu_15fDF\",\n\t\"menuTop\": \"menuTop_3pH2W\",\n\t\"menuContent\": \"menuContent_2V06a\",\n\t\"pane\": \"pane_FR57c\",\n\t\"title\": \"title_109pZ\",\n\t\"content\": \"content_3W3ih\",\n\t\"footerAction\": \"footerAction_1xl28\"\n};\nexport default ___CSS_LOADER_EXPORT___;\n","import { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { Button, Form, Modal, Space, Tabs, Popconfirm } from 'antd';\r\nimport json5 from 'json5';\r\nimport { FormItem, Content, useHeight, useDebounceValidator } from '@ra-lib/admin';\r\nimport config from 'src/commons/config-hoc';\r\nimport { WITH_SYSTEMS } from 'src/config';\r\nimport options from 'src/options';\r\nimport styles from './style.less';\r\n\r\nconst menuTargetOptions = options.menuTarget;\r\n\r\nconst TabPane = Tabs.TabPane;\r\n\r\nexport default config()(function MenuEdit(props) {\r\n    const { isAdd, selectedMenu, onSubmit, onValuesChange } = props;\r\n\r\n    const [form] = Form.useForm();\r\n    const [loading, setLoading] = useState(false);\r\n    const [addTabKey, setAddTabKey] = useState('1');\r\n    const [textAreaHeight] = useHeight(null, 285);\r\n    const contentRef = useRef(null);\r\n\r\n    const hasSelectedMenu = selectedMenu && Object.keys(selectedMenu).length;\r\n    const isAddTop = isAdd && !hasSelectedMenu;\r\n    const isAddSub = isAdd && hasSelectedMenu;\r\n    const title = (() => {\r\n        if (isAddTop) return WITH_SYSTEMS ? '添加应用' : '添加顶级';\r\n\r\n        return isAddSub ? '添加菜单' : '修改菜单';\r\n    })();\r\n\r\n    const { run: deleteMenu } = props.ajax.useDel('/menu/:id', null, { setLoading });\r\n    const { run: saveMenu } = props.ajax.usePost('/menu/addMenu', null, { setLoading });\r\n    const { run: branchSaveMenu } = props.ajax.usePost('/menu/addSubMenus', null, { setLoading });\r\n    const { run: updateMenu } = props.ajax.usePost('/menu/updateMenuById', null, { setLoading });\r\n    const { run: fetchMenuByName } = props.ajax.useGet('/menu/getOneMenu');\r\n    const { run: saveRole } = props.ajax.usePost('/role/addRole', null, { setLoading });\r\n\r\n    // 表单回显\r\n    useEffect(() => {\r\n        form.resetFields();\r\n        let initialValues = { ...selectedMenu, order: selectedMenu?.ord };\r\n        if (isAddTop) initialValues = { target: 'qiankun' };\r\n        if (isAddSub)\r\n            initialValues = {\r\n                target: 'menu',\r\n                parentId: selectedMenu.id,\r\n                systemId: selectedMenu.systemId,\r\n            };\r\n\r\n        form.setFieldsValue(initialValues);\r\n    }, [form, isAdd, isAddTop, isAddSub, selectedMenu]);\r\n\r\n    const handleSubmit = useCallback(\r\n        async (values) => {\r\n            if (loading) return;\r\n\r\n            const params = {\r\n                ...values,\r\n                type: 1, // 菜单\r\n                sort: values.order,\r\n                ord: values.order,\r\n            };\r\n\r\n            if (isAdd) {\r\n                if (isAddSub && addTabKey === '2') {\r\n                    let { menus, parentId } = values;\r\n\r\n                    try {\r\n                        menus = json5.parse(menus);\r\n                    } catch (e) {\r\n                        return Modal.error({\r\n                            title: '温馨提示',\r\n                            content: '批量添加的菜单数据有误，请修正后保存！',\r\n                        });\r\n                    }\r\n\r\n                    const params = { menus, parentId };\r\n                    const res = await branchSaveMenu(params);\r\n                    const { id } = res;\r\n                    onSubmit && onSubmit({ id, isAdd: true });\r\n                } else {\r\n                    const res = await saveMenu(params);\r\n                    const { id } = res;\r\n                    onSubmit && onSubmit({ ...params, id, isAdd: true });\r\n\r\n                    // 有系统的概念，并且是添加顶级，创建一个系统管理员\r\n                    if (WITH_SYSTEMS && isAddTop) {\r\n                        await saveRole({\r\n                            systemId: id,\r\n                            name: '系统管理员',\r\n                            enabled: true,\r\n                            remark: '拥有当前子系统所有权限',\r\n                            type: 2,\r\n                        });\r\n                    }\r\n                }\r\n            } else {\r\n                await updateMenu(params);\r\n                onSubmit && onSubmit({ ...params, isUpdate: true });\r\n            }\r\n        },\r\n        [addTabKey, branchSaveMenu, isAdd, isAddSub, isAddTop, loading, onSubmit, saveMenu, saveRole, updateMenu],\r\n    );\r\n\r\n    const checkName = useDebounceValidator(async (rule, value) => {\r\n        if (!value) return;\r\n\r\n        const menu = await fetchMenuByName({ name: value });\r\n        if (!menu) return;\r\n\r\n        const id = form.getFieldValue('id');\r\n        const menuId = `${menu.id}`;\r\n        if (isAdd && menu.name === value) throw Error('注册名称不能重复！');\r\n        if (!isAdd && menuId !== id && menu.name === value) throw Error('注册名称不能重复！');\r\n    });\r\n\r\n    const handleDelete = useCallback(async () => {\r\n        const id = selectedMenu?.id;\r\n        await deleteMenu({ id });\r\n\r\n        onSubmit && onSubmit({ id, isDelete: true });\r\n    }, [deleteMenu, onSubmit, selectedMenu?.id]);\r\n\r\n    const layout = {\r\n        labelCol: { flex: '100px' },\r\n    };\r\n\r\n    return (\r\n        <Form\r\n            className={styles.pane}\r\n            name={`menu-form`}\r\n            form={form}\r\n            onFinish={handleSubmit}\r\n            onValuesChange={onValuesChange}\r\n            initialValues={{ enabled: true }}\r\n        >\r\n            <h3 className={styles.title}>{title}</h3>\r\n            <Content ref={contentRef} loading={loading} className={styles.content}>\r\n                {isAddSub ? (\r\n                    <Tabs activeKey={addTabKey} onChange={(key) => setAddTabKey(key)}>\r\n                        <TabPane key=\"1\" tab=\"单个添加\" />\r\n                        <TabPane key=\"2\" tab=\"批量添加\" />\r\n                    </Tabs>\r\n                ) : null}\r\n                <FormItem name=\"id\" hidden />\r\n                <FormItem name=\"parentId\" hidden />\r\n                {addTabKey === '1' ? (\r\n                    <>\r\n                        <FormItem\r\n                            {...layout}\r\n                            label=\"类型\"\r\n                            type=\"select\"\r\n                            name=\"target\"\r\n                            options={menuTargetOptions}\r\n                            tooltip=\"指定类型之后，将以乾坤子项目或第三方网站方式打开\"\r\n                            required\r\n                            getPopupContainer={() => contentRef.current}\r\n                        />\r\n                        <FormItem {...layout} label=\"标题\" name=\"title\" required tooltip=\"菜单标题\" />\r\n                        <FormItem {...layout} type=\"number\" label=\"排序\" name=\"order\" tooltip=\"降序，越大越靠前\" />\r\n                        <FormItem {...layout} label=\"路径\" name=\"path\" tooltip=\"菜单路径或第三方网站地址\" />\r\n                        <FormItem\r\n                            {...layout}\r\n                            type=\"switch\"\r\n                            label=\"启用\"\r\n                            name=\"enabled\"\r\n                            checkedChildren=\"启\"\r\n                            unCheckedChildren=\"禁\"\r\n                            tooltip=\"是否启用\"\r\n                        />\r\n                        <FormItem shouldUpdate noStyle>\r\n                            {({ getFieldValue }) => {\r\n                                const target = getFieldValue('target');\r\n                                if (target === 'qiankun') {\r\n                                    return (\r\n                                        <>\r\n                                            <FormItem\r\n                                                {...layout}\r\n                                                label=\"注册名称\"\r\n                                                tooltip=\"要与子应用package.json中声明的name属性相同，唯一不可重复\"\r\n                                                name=\"name\"\r\n                                                rules={[\r\n                                                    { validator: checkName },\r\n                                                    {\r\n                                                        pattern: /^[0-9A-Za-z_-]+$/,\r\n                                                        message: '只允许英文大小写、_、-！',\r\n                                                    },\r\n                                                ]}\r\n                                                required\r\n                                            />\r\n                                            <FormItem\r\n                                                {...layout}\r\n                                                label=\"入口地址\"\r\n                                                tooltip=\"http(s)开头的网址\"\r\n                                                name=\"entry\"\r\n                                                rules={[\r\n                                                    {\r\n                                                        validator: (rule, value) => {\r\n                                                            if (value && !value.startsWith('http'))\r\n                                                                return Promise.reject('请输入正确的入口地址！');\r\n                                                            return Promise.resolve();\r\n                                                        },\r\n                                                    },\r\n                                                ]}\r\n                                                noSpace\r\n                                                required\r\n                                            />\r\n                                        </>\r\n                                    );\r\n                                }\r\n\r\n                                return (\r\n                                    <FormItem\r\n                                        {...layout}\r\n                                        label=\"基础路径\"\r\n                                        name=\"basePath\"\r\n                                        tooltip=\"所有其子菜单路径将以此为前缀\"\r\n                                    />\r\n                                );\r\n                            }}\r\n                        </FormItem>\r\n                    </>\r\n                ) : (\r\n                    <FormItem\r\n                        labelCol={{ flex: 0 }}\r\n                        type=\"textarea\"\r\n                        name=\"menus\"\r\n                        rows={16}\r\n                        rules={[{ required: true, message: '请输入菜单数据！' }]}\r\n                        style={{ height: textAreaHeight }}\r\n                        placeholder={`批量添加子菜单，结构如下：\r\n[\r\n    {id: 'system', title: '系统管理', order: 900},\r\n    {id: 'user', parentId: 'system', title: '用户管理', path: '/users', order: 900},\r\n    {id: 'menus', parentId: 'system', title: '菜单管理', path: '/menus', order: 900},\r\n    {id: 'role', parentId: 'system', title: '角色管理', path: '/roles', order: 900},\r\n    {\r\n        id: 'demo', parentId: 'system', title: '测试子应用',\r\n        target: 'qiankun',\r\n\r\n        name: 'react-admin',\r\n        entry: 'http://localhost:3000',\r\n\r\n        order: 850,\r\n    },\r\n]\r\n                            `}\r\n                    />\r\n                )}\r\n            </Content>\r\n            <Space className={styles.footerAction}>\r\n                {!isAdd ? (\r\n                    <Popconfirm title={`您确定删除「${selectedMenu?.title}」？`} onConfirm={handleDelete}>\r\n                        <Button loading={loading} danger>\r\n                            删除\r\n                        </Button>\r\n                    </Popconfirm>\r\n                ) : null}\r\n                <Button loading={loading} type=\"primary\" htmlType=\"submit\">\r\n                    保存\r\n                </Button>\r\n            </Space>\r\n        </Form>\r\n    );\r\n});\r\n","// This icon file is generated automatically.\nvar PlusOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"defs\", \"attrs\": {}, \"children\": [{ \"tag\": \"style\", \"attrs\": {} }] }, { \"tag\": \"path\", \"attrs\": { \"d\": \"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z\" } }, { \"tag\": \"path\", \"attrs\": { \"d\": \"M176 474h672q8 0 8 8v60q0 8-8 8H176q-8 0-8-8v-60q0-8 8-8z\" } }] }, \"name\": \"plus\", \"theme\": \"outlined\" };\nexport default PlusOutlined;\n","// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport PlusOutlinedSvg from \"@ant-design/icons-svg/es/asn/PlusOutlined\";\nimport AntdIcon from '../components/AntdIcon';\n\nvar PlusOutlined = function PlusOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, Object.assign({}, props, {\n    ref: ref,\n    icon: PlusOutlinedSvg\n  }));\n};\n\nPlusOutlined.displayName = 'PlusOutlined';\nexport default /*#__PURE__*/React.forwardRef(PlusOutlined);","import { useState, useEffect, useCallback } from 'react';\r\nimport { Button, Empty, Form, Space } from 'antd';\r\nimport { MinusCircleOutlined, PlusOutlined } from '@ant-design/icons';\r\nimport { FormItem, Content } from '@ra-lib/admin';\r\nimport config from 'src/commons/config-hoc';\r\nimport styles from './style.less';\r\n\r\nexport default config()(function ActionEdit(props) {\r\n    const [form] = Form.useForm();\r\n    const { isAdd, selectedMenu, onSubmit, onValuesChange } = props;\r\n    const [loading, setLoading] = useState(false);\r\n    const { run: save } = props.ajax.usePost('/menu/updateSubActions', null, {\r\n        setLoading,\r\n        successTip: '功能保存成功！',\r\n    });\r\n\r\n    const handleSubmit = useCallback(\r\n        async (values) => {\r\n            const { actions } = values;\r\n            const parentId = selectedMenu?.id;\r\n\r\n            await save({ actions, parentId });\r\n\r\n            onSubmit && onSubmit(actions);\r\n        },\r\n        [onSubmit, selectedMenu, save],\r\n    );\r\n\r\n    useEffect(() => {\r\n        form.resetFields();\r\n\r\n        if (!selectedMenu) return;\r\n\r\n        form.setFieldsValue({ actions: selectedMenu?.actions });\r\n    }, [selectedMenu, form]);\r\n\r\n    return (\r\n        <Form\r\n            className={styles.pane}\r\n            name={`action-form`}\r\n            form={form}\r\n            onFinish={handleSubmit}\r\n            onValuesChange={onValuesChange}\r\n        >\r\n            <h3 className={styles.title}>功能列表</h3>\r\n            <Content loading={loading} className={styles.content}>\r\n                {isAdd ? (\r\n                    <Empty style={{ marginTop: 50 }} description=\"请选择或保存新增菜单\" />\r\n                ) : (\r\n                    <Form.List name=\"actions\">\r\n                        {(fields, { add, remove }) => (\r\n                            <>\r\n                                {fields.map(({ key, name }) => {\r\n                                    return (\r\n                                        <Space key={key} style={{ display: 'flex', marginBottom: 8 }} align=\"baseline\">\r\n                                            <FormItem hidden name={[name, 'id']} />\r\n                                            <FormItem\r\n                                                type=\"switch\"\r\n                                                name={[name, 'enabled']}\r\n                                                initialValue={true}\r\n                                                checkedChildren=\"启\"\r\n                                                unCheckedChildren=\"禁\"\r\n                                            />\r\n                                            <FormItem\r\n                                                name={[name, 'title']}\r\n                                                placeholder=\"名称\"\r\n                                                rules={[{ required: true, message: '请输入名称！' }]}\r\n                                            />\r\n                                            <FormItem\r\n                                                name={[name, 'code']}\r\n                                                placeholder=\"编码\"\r\n                                                rules={[{ required: true, message: '请输入编码！' }]}\r\n                                            />\r\n                                            <MinusCircleOutlined\r\n                                                style={{ color: 'red' }}\r\n                                                onClick={() => remove(name)}\r\n                                            />\r\n                                        </Space>\r\n                                    );\r\n                                })}\r\n                                <FormItem>\r\n                                    <Button type=\"dashed\" onClick={() => add()} block icon={<PlusOutlined />}>\r\n                                        新增编码\r\n                                    </Button>\r\n                                </FormItem>\r\n                            </>\r\n                        )}\r\n                    </Form.List>\r\n                )}\r\n            </Content>\r\n            <Space className={styles.footerAction}>\r\n                <Button loading={loading} disabled={isAdd} type=\"primary\" htmlType=\"submit\">\r\n                    保存\r\n                </Button>\r\n            </Space>\r\n        </Form>\r\n    );\r\n});\r\n","import { useEffect, useState, useMemo, useCallback } from 'react';\r\nimport { Menu, Button, Space, Empty } from 'antd';\r\nimport { PageContent, confirm, convertToTree, sort, findNextNode } from '@ra-lib/admin';\r\nimport config from 'src/commons/config-hoc';\r\nimport { WITH_SYSTEMS } from 'src/config';\r\nimport MenuEdit from './MenuEdit';\r\nimport ActionEdit from './ActionEdit';\r\nimport theme from 'src/theme.less';\r\nimport s from './style.less';\r\n\r\nexport default config({\r\n    path: '/system/menus',\r\n})(function MenuManager(props) {\r\n    const [isAdd, setIsAdd] = useState(true);\r\n    const [selectedMenu, setSelectedMenu] = useState(null);\r\n    const [hasUnSaveMenu, setHasUnSaveMenu] = useState(false);\r\n    const [hasUnSaveAction, setHasUnSaveAction] = useState(false);\r\n    const {\r\n        loading,\r\n        data: menus = [],\r\n        run: fetchMenus,\r\n    } = props.ajax.useGet('/menu/queryMenus', null, {\r\n        formatResult: (res) => {\r\n            return (res || [])\r\n                .map((item, index, arr) => {\r\n                    const actions = arr.filter((it) => it.type === 2 && it.parentId === item.id);\r\n                    return {\r\n                        ...item,\r\n                        id: '' + item.id,\r\n                        parentId: item.parentId ? '' + item.parentId : item.parentId,\r\n                        order: item.order ?? item.sort ?? item.ord,\r\n                        actions,\r\n                    };\r\n                })\r\n                .filter((item) => item.type === 1);\r\n        },\r\n    });\r\n\r\n    const checkUnSave = useCallback(\r\n        async (showTip = true) => {\r\n            if (showTip && hasUnSaveMenu) await confirm('菜单有未保存数据，是否放弃？');\r\n            setHasUnSaveMenu(false);\r\n\r\n            if (showTip && hasUnSaveAction) await confirm('功能列表有未保存数据，是否放弃？');\r\n            setHasUnSaveAction(false);\r\n        },\r\n        [hasUnSaveMenu, hasUnSaveAction],\r\n    );\r\n\r\n    const handleClick = useCallback(\r\n        async ({ key }, showTip = true) => {\r\n            await checkUnSave(showTip);\r\n\r\n            const menuData = menus.find((item) => item.id === key);\r\n            setSelectedMenu(menuData);\r\n            setIsAdd(false);\r\n        },\r\n        [checkUnSave, menus],\r\n    );\r\n\r\n    const [menuItems, menuTreeData] = useMemo(() => {\r\n        const menuTreeData = convertToTree(sort(menus, (a, b) => b.order - a.order));\r\n        const loop = (nodes) =>\r\n            nodes.map((item) => {\r\n                let { id, icon, title, children } = item;\r\n\r\n                if (children && children.length) {\r\n                    return (\r\n                        <Menu.SubMenu\r\n                            key={id}\r\n                            title={\r\n                                <span\r\n                                    onClick={async (e) => {\r\n                                        e.stopPropagation();\r\n                                        await handleClick({ key: id });\r\n                                    }}\r\n                                >\r\n                                    {title}\r\n                                </span>\r\n                            }\r\n                            icon={icon}\r\n                            className={selectedMenu?.id === id ? `${theme.antPrefix}-menu-item-selected` : ''}\r\n                            data-menu={item}\r\n                        >\r\n                            {loop(children)}\r\n                        </Menu.SubMenu>\r\n                    );\r\n                }\r\n                return (\r\n                    <Menu.Item key={id} icon={icon} data-menu={item}>\r\n                        {title}\r\n                    </Menu.Item>\r\n                );\r\n            });\r\n\r\n        return [loop(menuTreeData), menuTreeData];\r\n        // eslint-disable-next-line\r\n    }, [menus, selectedMenu, hasUnSaveMenu]);\r\n\r\n    useEffect(() => {\r\n        (async () => {\r\n            await fetchMenus();\r\n        })();\r\n    }, [fetchMenus]);\r\n\r\n    const handleMenuSubmit = useCallback(\r\n        async (data) => {\r\n            setHasUnSaveMenu(false);\r\n            const { isAdd, isDelete, isUpdate, id } = data;\r\n\r\n            await fetchMenus();\r\n\r\n            if (isAdd) {\r\n                setSelectedMenu({ ...selectedMenu });\r\n            }\r\n\r\n            if (isUpdate) {\r\n            }\r\n\r\n            if (isDelete) {\r\n                const nextNode = findNextNode(menuTreeData, id);\r\n                if (nextNode) {\r\n                    await handleClick({ key: nextNode.id }, false);\r\n                } else {\r\n                    // 删没了\r\n                    setSelectedMenu({});\r\n                    setIsAdd(true);\r\n                }\r\n            }\r\n        },\r\n        [fetchMenus, handleClick, menuTreeData, selectedMenu],\r\n    );\r\n\r\n    const handleActionSubmit = useCallback(async () => {\r\n        setHasUnSaveAction(false);\r\n\r\n        await fetchMenus();\r\n    }, [fetchMenus]);\r\n\r\n    return (\r\n        <PageContent loading={loading} fitHeight className={s.menuRoot}>\r\n            <div className={s.menu}>\r\n                <Space className={s.menuTop}>\r\n                    <Button\r\n                        type=\"primary\"\r\n                        onClick={async () => {\r\n                            await checkUnSave();\r\n                            setIsAdd(true);\r\n                            setSelectedMenu(null);\r\n                        }}\r\n                    >\r\n                        {WITH_SYSTEMS ? '添加应用' : '添加顶级'}\r\n                    </Button>\r\n                    <Button\r\n                        disabled={!selectedMenu}\r\n                        type=\"primary\"\r\n                        onClick={async () => {\r\n                            await checkUnSave();\r\n                            setIsAdd(true);\r\n                        }}\r\n                    >\r\n                        添加子级\r\n                    </Button>\r\n                </Space>\r\n                <div className={s.menuContent}>\r\n                    {menus?.length ? (\r\n                        <Menu\r\n                            mode=\"inline\"\r\n                            selectable\r\n                            selectedKeys={[selectedMenu?.id]}\r\n                            onClick={(info) => handleClick(info)}\r\n                        >\r\n                            {menuItems}\r\n                        </Menu>\r\n                    ) : (\r\n                        <Empty style={{ marginTop: 58 }} description=\"暂无数据\" />\r\n                    )}\r\n                </div>\r\n            </div>\r\n            <MenuEdit\r\n                isAdd={isAdd}\r\n                selectedMenu={selectedMenu}\r\n                onSubmit={handleMenuSubmit}\r\n                onValuesChange={() => setHasUnSaveMenu(true)}\r\n            />\r\n            <ActionEdit\r\n                isAdd={isAdd}\r\n                selectedMenu={selectedMenu}\r\n                onValuesChange={() => setHasUnSaveAction(true)}\r\n                onSubmit={handleActionSubmit}\r\n            />\r\n        </PageContent>\r\n    );\r\n});\r\n","import { wrapperOptions } from '@ra-lib/admin';\r\n\r\n/**\r\n * 使用 require.context 自动引入所有model文件\r\n * */\r\nconst result = {};\r\n\r\n// src/models目录下，不支持子文件夹\r\nconst req = require.context('./', false, /\\.js$/);\r\nreq.keys().forEach((key) => {\r\n    if (['./index.js'].includes(key)) return;\r\n\r\n    const model = req(key);\r\n\r\n    const options = model.default;\r\n    Object.entries(options).forEach(([k, value]) => {\r\n        if (k in result) throw Error(`${key} 文件中 key 「${k}」已被使用！请更换！`);\r\n        result[k] = value;\r\n    });\r\n});\r\n\r\nwrapperOptions(result, 1000 * 5);\r\n\r\nexport default result;\r\n"],"sourceRoot":""}